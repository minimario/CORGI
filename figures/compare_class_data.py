import numpy as np
import matplotlib
from math import log10
from matplotlib import pyplot as plt

matplotlib.rcParams.update({'font.size': 16})

plt.rc('font', family='serif')

xs = [i for i in range(100)]

cert_30 = [0.000265625, 2.34375e-05, 0.0003125, 0.000109375, 0.0006796875, 0.0001875, 0.000109375, 0.000234375, 7.8125e-06, 7.031250000000001e-05, 0.00053125, 0.00016406249999999998, 0.0002578125, 0.0002578125, 7.031250000000001e-05, 0.00010156250000000001, 0.00042968750000000006, 0.00015625, 0.000515625, 3.125e-05, 0.00014843750000000002, 0.0005625000000000001, 0.0003125, 0.00042187500000000005, 2.34375e-05, 6.09e-06, 0.0001875, 0.0006953125, 0.0014453125, 0.000625, 0.0010703125, 4.6875e-05, 0.0002578125, 0.0010390625, 0.0009375, 0.00016406249999999998, 0.0005546875000000001, 0.00034375, 0.00032031249999999996, 7.058715820312502e-06, 0.00021093750000000002, 0.000625, 0.0001875, 0.0003671875, 0.0001171875, 0.00025, 0.0001953125, 0.00042187500000000005, 0.00021093750000000002, 0.0006484374999999999, 0.0001171875, 0.0008515625000000001, 0.0006093750000000001, 0.0005703125000000001, 0.0003515625, 0.0007734375, 0.0009765625, 0.0008593750000000001, 7.031250000000001e-05, 0.00029687500000000005, 0.001015625, 8.59375e-05, 0.000703125, 0.0009921875, 0.0006640624999999999, 1.5625e-05, 0.0006015625000000001, 0.00032031249999999996, 0.00016406249999999998, 0.00032031249999999996, 0.0007734375, 0.0004609375, 0.00032812499999999997, 0.0017421875000000002, 7.8125e-06, 0.00014062500000000002, 0.0006640624999999999, 0.0015937500000000001, 0.0001796875, 0.00029687500000000005, 0.0009609375, 0.0008359375000000001, 0.000390625, 0.00020312500000000002, 0.001546875, 0.0006796875, 0.0001328125, 0.00044531249999999996, 0.0005234375, 0.0005078125, 0.000109375, 6.25e-05, 0.00042968750000000006, 0.0007109375, 0.00046875, 6.25e-05, 0.00045312499999999997, 0.00014062500000000002, 0.0011015625000000001, 0.0005859375000000001]

attack_30 = [0.00076171875, 7.8125e-05, 0.00314453125, 0.0005859375000000001, 0.0033789062500000004, 0.00248046875, 0.000390625, 0.0011718750000000002, 3.90625e-05, 0.00033203124999999997, 0.0016796875000000002, 0.0008789062499999999, 0.00142578125, 0.00076171875, 0.00091796875, 0.000625, 0.001875, 0.0019140625, 0.0027734375, 0.00015625, 0.0006445312499999999, 0.00294921875, 0.0011132812500000001, 0.00185546875, 0.0001953125, 3.90625e-05, 0.000703125, 0.0033593750000000004, 0.00798828125, 0.0023437500000000003, 0.0033007812500000003, 0.0003125, 0.0016406250000000002, 0.010996093749999998, 0.0039648437500000005, 0.0006054687500000001, 0.002734375, 0.0013085937499999999, 0.00197265625, 3.90625e-05, 0.0012304687500000002, 0.0021484375, 0.00046875, 0.0028125, 0.000546875, 0.0008984374999999999, 0.0005664062500000001, 0.0026367187499999997, 0.0032421875000000003, 0.003125, 0.0006054687500000001, 0.007070312499999999, 0.00392578125, 0.0012695312499999998, 0.0014453125, 0.00201171875, 0.00416015625, 0.004609375000000001, 0.00271484375, 0.0018359375, 0.0028515625, 0.00033203124999999997, 0.0026953125, 0.0029296875, 0.00310546875, 0.0001171875, 0.00142578125, 0.0008203125000000001, 0.000546875, 0.0008984374999999999, 0.00158203125, 0.00185546875, 0.0011718750000000002, 0.00876953125, 5.859375e-05, 0.000703125, 0.0017773437499999998, 0.02, 0.0009765625, 0.000859375, 0.003125, 0.00279296875, 0.0016601562500000002, 0.00068359375, 0.007285156249999999, 0.004726562500000001, 0.0008984374999999999, 0.00185546875, 0.00197265625, 0.0025390624999999997, 0.00033203124999999997, 0.00015625, 0.0032617187500000003, 0.00388671875, 0.0025781249999999997, 0.0003125, 0.0013671875, 0.0004296875, 0.0032031250000000002, 0.003046875]

cert_17 = [0.0004931640625, 0.0008984374999999999, 7.324218750000001e-05, 1.220703125e-05, 0.00019775390625, 0.00012451171875, 3.90625e-05, 4.8828125e-05, 0.00010009765625000001, 1.953125e-05, 0.0005541992187500001, 9.765625e-06, 7.080078125000001e-05, 0.0005957031250000001, 0.00072998046875, 0.00012451171875, 0.000859375, 0.0002587890625, 0.0005078125, 7.324218750000001e-05, 0.00020751953125000002, 3.173828125e-05, 0.000126953125, 0.00026611328125, 0.00021728515624999998, 0.00037109375, 6.8359375e-05, 9.765625e-06, 0.00015136718750000003, 7.32421875e-06, 0.00010009765625000001, 0.00095703125, 0.00010498046875000001, 0.0006396484374999999, 0.00030273437500000005, 0.0001708984375, 0.00010986328124999999, 0.00014404296875000002, 0.00018798828125, 0.00021728515624999998, 0.00015380859375000003, 0.00025146484375, 0.0006860351562499999, 0.00014892578125000002, 0.00049072265625, 9.765625e-05, 0.00010253906250000001, 0.00028564453125000004, 6.34765625e-05, 0.00032470703124999996, 7.568359375000001e-05, 0.00010986328124999999, 0.00043212890625, 2.685546875e-05, 0.0005444335937500001, 0.00033203124999999997, 0.00015136718750000003, 2.44140625e-06, 0.00042724609375, 0.0010986328125, 0, 3.90625e-05, 0, 0.00038330078125, 0.00030273437500000005, 0.00017333984375, 2.44140625e-05, 6.8359375e-05, 0.00011230468749999999, 0.00036376953125, 1.708984375e-05, 0.0005126953125, 0.00028808593750000004, 9.765625e-05, 0.000478515625, 0.0007153320312499999, 0.00085693359375, 8.7890625e-05, 0.0001708984375, 8.544921875e-05, 0.000185546875, 0.0011694335937500002, 3.90625e-05, 0.00020263671875000002, 0.000126953125, 0.0006640624999999999, 0.0001708984375, 2.44140625e-05, 5.6152343749999996e-05, 0.0001806640625, 4.8828125e-06, 1.708984375e-05, 0.00010253906250000001, 0.00016357421874999998, 2.44140625e-05, 0.00021972656249999998, 1.220703125e-05, 0.00041992187500000005, 0.00012451171875, 9.521484375e-05]
# [0.00042968750000000006, 3.90625e-05, 0.0001875, 7.8125e-05, 3.90625e-05, 0.0007578125, 0.00053125, 0.00021093750000000002, 0.00045312499999999997, 0.0005390625, 0.0002421875, 0.0002734375, 0.0008437500000000001, 0.0004765625, 3.125e-05, 9.375e-05, 0.0005937500000000001, 9.375e-05, 0.0005234375, 1.5625e-05, 0.0009921875, 0.00034375, 1.5625e-05, 0.0007265625, 0.0001171875, 4.6875e-05, 0.00016406249999999998, 0.00028125000000000003, 0.001015625, 0.0005625000000000001, 0.0012656249999999998, 0.00032031249999999996, 0.0005625000000000001, 0.00021093750000000002, 0.00014062500000000002, 0.0001875, 0.0001953125, 0.0005546875000000001, 9.375e-05, 1.5625e-05, 0.000546875, 0.000125, 0.0006953125, 0.0001953125, 0.00042968750000000006, 8.59375e-05, 0.0005234375, 0.0005859375000000001, 0.0004921875, 0.000171875, 9.375e-05, 3.90625e-05, 0.00028125000000000003, 0.000234375, 1.5625e-05, 5.46875e-05, 0.00014843750000000002, 3.125e-05, 1.8408203125000002e-06, 0.0002421875, 3.90625e-05, 4.6875e-05, 0.000171875, 0.0006796875, 0.0001875, 0.00020312500000000002, 0.0005234375, 0.000390625, 7.031250000000001e-05, 7.031250000000001e-05, 0.00053125, 0.00075, 0.000359375, 0.00053125, 7.8125e-05, 0.0007734375, 0.000171875, 7.8125e-06, 0.0007109375, 0.0009375, 0.0005234375, 0.000375, 0.00044531249999999996, 0.0017031250000000002, 0.0011953125000000002, 0.0005390625, 9.375e-05, 0.0005937500000000001, 0.0006406249999999999, 0.0008437500000000001, 0.0008281250000000001, 0.00025, 9.375e-05, 0.00021093750000000002, 1.5734863281250003e-06, 0.00010156250000000001, 0.00014843750000000002, 0.000734375, 0.00046875, 0.0001171875]

attack_17 = [0.0016372680664062502, 0.0028582763671875, 0.00030883789062500003, 0.0026138305664062497, 0.00061676025390625, 0.00031646728515625, 0.00012176513671875, 9.552001953125e-05, 0.0006130981445312501, 5.340576171875e-05, 0.0027838134765624995, 7.263183593750001e-05, 0.00030212402343750007, 0.0039141845703125, 0.005374755859375, 0.0006817626953125, 0.0038369750976562497, 0.0009933471679687501, 0.0012716674804687498, 0.00034301757812499995, 0.00101318359375, 0.00012908935546875, 0.0006863403320312498, 0.00195220947265625, 0.00100189208984375, 0.001341552734375, 0.00021179199218750004, 3.9672851562499995e-05, 0.00091796875, 0.0004956054687500001, 0.0005368041992187501, 0.00302703857421875, 0.0005227661132812501, 0.0035766601562499997, 0.00519927978515625, 0.0005194091796875, 0.00023468017578124998, 0.0009695434570312499, 0.00195648193359375, 0.0016128540039062503, 0.004907531738281252, 0.0025564575195312494, 0.00227630615234375, 0.0023425292968750006, 0.0026254272460937496, 0.00039947509765625005, 0.00025665283203125, 0.0009512329101562499, 0.0026776123046875, 0.0017871093749999999, 0.00048034667968749995, 0.0007244873046875, 0.0021380615234375005, 0.0007257080078124999, 0.00276275634765625, 0.0016513061523437502, 0.0009445190429687501, 1.3122558593750001e-05, 0.00124725341796875, 0.00837005615234375, 0.00016113281249999998, 0.0001861572265625, 0.00038177490234375, 0.0017202758789062501, 0.000733642578125, 0.00034698486328125, 0.0001190185546875, 0.0006570434570312498, 0.000401611328125, 0.002476806640625, 3.7536621093750006e-05, 0.0014910888671875, 0.00275848388671875, 0.00039855957031250007, 0.0033972167968750007, 0.0038262939453125, 0.0038922119140625, 0.0016033935546875002, 0.0012771606445312498, 0.00043518066406249994, 0.00061798095703125, 0.00317291259765625, 0.000157470703125, 0.0006149291992187502, 0.0021194458007812497, 0.001790771484375, 0.00141693115234375, 0.0001470947265625, 0.0016375732421875003, 0.00142822265625, 7.843017578125001e-05, 9.1552734375e-05, 0.00049285888671875, 0.00021545410156250002, 0.00026123046875, 0.00039825439453125, 4.0893554687499996e-05, 0.00150299072265625, 0.00034729003906249997, 0.00176910400390625]
# old attack 17 [0.00685546875, 0.00015625, 0.00140625, 0.0003515625, 0.00033203124999999997, 0.00439453125, 0.0025976562499999997, 0.0043359375, 0.00201171875, 0.00279296875, 0.0008398437500000001, 0.0016601562500000002, 0.002109375, 0.0040625, 0.000234375, 0.001484375, 0.0031835937500000002, 0.000390625, 0.0022851562500000003, 0.0001171875, 0.0115625, 0.0057421875, 0.00013671875, 0.0023242187500000003, 0.0008007812500000001, 0.00037109375, 0.0005664062500000001, 0.00091796875, 0.0055078125, 0.0022070312500000002, 0.0081640625, 0.0012695312499999998, 0.009062500000000001, 0.0012304687500000002, 0.0032617187500000003, 0.0017968749999999999, 0.0005664062500000001, 0.006464843750000001, 0.0007421875, 0.0001171875, 0.005175781249999999, 0.0025, 0.00595703125, 0.0021875, 0.0024414062500000004, 0.000390625, 0.0033984375000000004, 0.0039453125, 0.0025781249999999997, 0.0016601562500000002, 0.00033203124999999997, 0.00025390625, 0.00154296875, 0.0025585937499999997, 9.765625e-05, 0.0003125, 0.0017968749999999999, 0.0003515625, 0.0008984374999999999, 0.00076171875, 0.00048828125, 0.00021484375, 0.0006054687500000001, 0.0024023437500000004, 0.00072265625, 0.0005859375000000001, 0.0032617187500000003, 0.00185546875, 0.0011132812500000001, 0.00033203124999999997, 0.0022070312500000002, 0.005175781249999999, 0.0032226562500000003, 0.0035156249999999997, 0.000390625, 0.0026757812499999998, 0.0006054687500000001, 0.001484375, 0.0027734375, 0.004667968750000001, 0.009003906250000002, 0.0016015625000000001, 0.010136718749999999, 0.0064843750000000006, 0.00763671875, 0.0023437500000000003, 0.00041015625000000004, 0.0042578125, 0.00390625, 0.0059375, 0.00861328125, 0.00400390625, 0.00033203124999999997, 0.0008007812500000001, 0.00142578125, 0.00205078125, 0.00189453125, 0.00521484375, 0.0039453125, 0.00072265625]

pack_30 = [(cert_30[i], attack_30[i]) for i in xs]
pack_17 = [(cert_17[i], attack_17[i]) for i in xs]

pack_30.sort()
pack_17.sort()

f = log10
f = lambda x:x
ys_30 = [f(i[0]) for i in pack_30]
zs_30 = [f(i[1]) for i in pack_30]
ys_17 = [f(i[0]) for i in pack_17]
zs_17 = [f(i[1]) for i in pack_17]


def plot1():
	fig, ax = plt.subplots()
	l1 = ax.scatter(xs, ys_30, color='darkseagreen', s=20, marker="o", label='class 12, guarantee')
	l2 = ax.scatter(xs, zs_30, color='green', s=60, marker='*', label='class 12, attack')
	l3 = ax.scatter(xs, ys_17, color='red', s=20, marker="o", label='class 17, guarantee')
	l4 = ax.scatter(xs, zs_17, color='crimson', s=60, marker='*', label='class 17, attack bounds')
	# ax.legend()
	# plt.show()

	lw = 0.5
	# ax.axis('off')
	# ax.set_xticks([])
	# l1 = plt.scatter(ys_30, zs_30, s=2, label='class 30')
	# l1,=plt.plot(xs, ys_30, 'ro-', linewidth=lw, markersize=2, label='class 30, guarantee')
	# l2,=plt.plot(xs, zs_30, 'ro--', linewidth=lw, markersize=2, label='class 30, attack')
	# l3,=plt.plot(xs, ys_17, 'bo-', linewidth=lw, markersize=2, label='class 17, guarantee')
	# l4,=plt.plot(xs, zs_17, 'bo--', linewidth=lw, markersize=2, label='class 17, attack bounds')
	# l2 = plt.scatter(ys_17, zs_17, s=2, label='class 17')
	# plt.ylabel('log(value)')
	plt.legend(handles=[l1, l2, l3, l4])

	# coef = np.polyfit(ys_30,zs_30,1)
	# print(coef)
	# poly1d_fn = np.poly1d(coef) 
	# plt.plot(ys_30,zs_30, 'go', ys_30, poly1d_fn(ys_30), '--k', markersize=2)

	# lims = [
	    # np.min([ax.get_xlim(), ax.get_ylim()]),  # min of both axes
	    # np.max([ax.get_xlim(), ax.get_ylim()]),  # max of both axes
	# ]
	# ax.plot(lims, lims, 'k-', alpha=0.75, zorder=0)
	# ax.set_aspect('equal')
	# ax.set_xlim(np.array(lims))
	ax.set_ylim(0, 0.005)

	plt.title("CORGI/Attack Bounds for 2 GTSRB Classes", fontsize=20, y=1.03)
	ax.set_xlabel('Image Number (Sorted by CORGI Bound)', fontsize=16)
	ax.set_ylabel("Bound", fontsize=16)

	# plt.legend(handles=[l1, l2])
	plt.show()

def plot2():
	fig, axes = plt.subplots(nrows=1, ncols=2)
	diff30 = [i[1]/i[0] for i in pack_30 if i[0]!= 0]
	diff17 = [i[1]/i[0] for i in pack_17 if i[0] != 0]
	diff17.sort()
	diff30.sort()
	print(diff17[49], diff17[50])
	print(diff30[49], diff30[50])
	import seaborn as sns
	print("lengths plotted: 12 ", len([i for i in diff30 if i<20]))
	print("lengths plotted: 17 ", len([i for i in diff17 if i<20]))
	sns.distplot([i for i in diff30 if i<20], kde=False, ax = axes[1], bins=30)
	sns.distplot([i for i in diff17 if i<20], kde=False, ax = axes[0], bins=30)
	plt.suptitle("Gap Between Attack UB and CORGI LB", fontsize=25)
	axes[0].set_xlabel('UB/LB Ratio', fontsize=18)
	axes[0].set_ylabel("Count", fontsize=18)
	axes[0].set_title('Class 17\n(No Entry)', fontsize=19)

	axes[1].set_xlabel('UB/LB Ratio', fontsize=19)
	axes[1].set_title('Class 12\n(Priority Road)', fontsize=19)

	plt.show()

def plot3():
	fig, ax = plt.subplots()
	l1 = ax.scatter(xs, ys_30, color='darkseagreen', s=20, marker="o", label='class 12, guarantee')
	# l2 = ax.scatter(xs, zs_30, color='red', s=60, marker='*', label='class 12, attack')
	lw = 0.5
	plt.legend(handles=[l1])
	ax.set_ylim(0, 0.005)
	plt.title("CORGI Bounds for 1 Class", fontsize=20, y=1.03)
	ax.set_xlabel('Image Number (Sorted by CORGI Bound)', fontsize=16)
	ax.set_ylabel("Bound", fontsize=16)
	# plt.legend(handles=[l1, l2])
	plt.show()

def plot4():
	fig, axes = plt.subplots()
	diff30 = [i[1]/i[0] for i in pack_30 if i[0]!= 0]
	# diff17 = [i[1]/i[0] for i in pack_17 if i[0] != 0]
	# diff17.sort()
	diff30.sort()
	# print(diff17[49], diff17[50])
	print(diff30[49], diff30[50])
	import seaborn as sns
	print("lengths plotted: 12 ", len([i for i in diff30 if i<20]))
	# print("lengths plotted: 17 ", len([i for i in diff17 if i<20]))
	sns.distplot([i for i in diff30 if i<20], kde=False, ax = axes, bins=30)
	# sns.distplot([i for i in diff17 if i<20], kde=False, ax = axes[0], bins=30)
	plt.suptitle("Gap Between Attack and CORGI", fontsize=25)
	axes.set_xlabel('UB/LB Ratio', fontsize=18)
	axes.set_ylabel("Count", fontsize=18)
	# axes.set_title('Class 12\n(Priority Road)', fontsize=19)
	plt.show()
# plt.scatter(xs, ys_30, color='green')
# plt.scatter(xs, zs_30, color='blue')
# plt.scatter(xs, ys_17, color='orange')
# plt.scatter(xs, zs_17, color='purple')
# plot1()
# plot2/
plot3()
# plot4()